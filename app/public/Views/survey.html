<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/../css/style.css">
    <title>Survey</title>
</head>
<body>
    <div class='container jumbotron'>
        <main>
            <h2>Survey Questions</h2>
            <hr>
            <h3>About You</h3>
            <p>Name (Required)</p>
            <input class='form-control' type='text' required id='userName'>
            <br>
            <p>Link to Photo Image (Required)</p>
            <input class='form-control' type='text' required id='image'>

            <hr>

            <h3 class='display-5'>Question 1</h3>
            <h3 class='display-6'>You enjoy working in an Agile Environment: </h3>
            <select class='chosen-select' id="question1">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 2</h3>
            <h3 class='display-6'>You enjoy working within a development team:</h3>
            <select class='chosen-select' id="question2">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 3</h3>
            <h3 class='display-6'>You prefer front-end frameworks more than Vanilla Javascript:</h3>
            <select class='chosen-select' id="question3">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 4</h3>
            <h3 class='display-6'>You prefer Node.js to other backend languages:</h3>
            <select class='chosen-select' id="question4">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 5</h3>
            <h3 class='display-6'>You prefer Vanilla Javascript over popular DOM abstraction libraries, such as jQuery:</h3>
            <select class='chosen-select' id="question5">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 6</h3>
            <h3 class='display-6'>You are comfortable with Ecma Script 2015:</h3>
            <select class='chosen-select' id="question6">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 7</h3>
            <h3 class='display-6'>You are comfortable with common node packages, such Express:</h3>
            <select class='chosen-select' id="question7">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 8</h3>
            <h3 class='display-6'>You enjoy working in non-relational databases, such as Mongo_DB or Firebase:</h3>
            <select class='chosen-select' id="question8">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 9</h3>
            <h3 class='display-6'>You are comfortable working with common CSS frameworks, such as Bootstrap or Foundation:</h3>
            <select class='chosen-select' id="question9">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <h3 class='display-5'>Question 10</h3>
            <h3 class='display-6'>You consider yourself to be a fullstack Javascript developer:</h3>
            <select class='chosen-select' id="question10">
                <option value="1">1 (Strongly Disagree)</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5 (Strongly Agree)</option>
            </select>

            <!-- Need to make this link return json from the api/developers route -->
            <div class='text-center'>
                <a href='/api/developers' class='text-center' style'text-decoration: none !important;'>
                    <button id='button' class='btn btn-outline-dark btn-lg btn-block' style='margin-top:30px;'>Submit Survey</button>
                </a>
            </div>
        </main>
        <section id='modal' class='modal'>
            <div id='modal-content' class='modal-content container text-center'>


                <button id="close" class="btn btn-danger">Close</button>
            </div>
        </section>
    </div>

    <script>
        // believe i need to make a post request to api/devs
        const subButton = document.querySelector('#button');
        subButton.addEventListener('click', (event) => {
            event.preventDefault();

            const data = 'apples';

            const scores = [];
            const userName = document.getElementById('userName').value.trim();
            const userImage = document.querySelector('#image').value.trim();
            const questionList = document.querySelectorAll('select');
            questionList.forEach((curVal) => {scores.push(parseInt(curVal.value))});
            const totalScore = scores.reduce((acc, curVal) => {
                return acc += curVal
            }, 0);

            if (userName && userImage) {
                const userObj = {
                    name: userName,
                    image: userImage,
                    developerScore: totalScore
                }

                const xhr = new XMLHttpRequest();
                xhr.open('POST', '/api/developers', true);
                xhr.onload = function () {
                    if (this.status === 200) {
                        let apiResponse = JSON.parse(this.responseText);
                        console.log(apiResponse);
                        createModal(apiResponse);
                    }
                }
                xhr.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
                xhr.send(JSON.stringify(userObj));
            } else {
                alert('Please complete both the name and image forms before submitting.');
            } 

        });

        responseData = () => {

        }

        createModal = (results) => {
            const infoText = document.createElement("p");
            const modal = document.querySelector("#modal");
            const modalContent = document.querySelector("#modal-content");
            const imgTag = document.createElement("img");
            const nameEle = document.createElement("h3");
            const nameText = document.createTextNode(results[1].name);
            const quoteEle = document.createElement('p');
            const quoteText = document.createTextNode(results[1].quote);

            // need to style images for consistency

            modal.style.display = "block";
            infoText.appendChild(document.createTextNode("You're Closest Match"));
            quoteEle.appendChild(quoteText);
            modalContent.insertBefore(infoText,closeButton);
            modalContent.insertBefore(nameEle, closeButton);
            modalContent.insertBefore(imgTag, closeButton);
            modalContent.insertBefore(quoteEle, closeButton)
            nameEle.appendChild(nameText);
            imgTag.setAttribute('src', results[1].image);
            imgTag.style.height = '300px';
            imgTag.style.width = '300px';
            imgTag.style.margin = 'auto';


        }

        const closeButton = document.querySelector("#close");

        closeButton.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    </script>
</body>
</html>